<template>
  <div class="content">
    <div class="top">
      <svg width="203" height="50" viewBox="0 0 203 50" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M61.9609 13.033H67.0952V37.7812H61.9609V13.033ZM64.5239 33.9292H71.5139C72.9784 33.9292 74.1018 33.6271 74.884 33.0313C75.6662 32.427 76.0574 31.5627 76.0574 30.413V30.3794C76.0574 29.6241 75.8826 28.9863 75.5248 28.466C75.167 27.9457 74.6344 27.5513 73.9271 27.2911C73.2198 27.0309 72.346 26.8967 71.2975 26.8967H64.5322V23.3804H70.6901C72.138 23.3804 73.2447 23.0867 74.002 22.5076C74.7592 21.9286 75.1337 21.0977 75.1337 20.0236V19.99C75.1337 19.0081 74.8008 18.2444 74.1268 17.7073C73.4528 17.1703 72.5208 16.9017 71.3225 16.9017H64.5406V13.0414H72.6539C74.21 13.0414 75.5414 13.2931 76.6648 13.7966C77.7882 14.3002 78.6536 15.0135 79.2694 15.945C79.8852 16.8765 80.1848 17.9759 80.1848 19.2431V19.2767C80.1848 20.1914 79.9767 21.0306 79.5606 21.8027C79.1446 22.5747 78.5787 23.2125 77.8714 23.7245C77.1641 24.2364 76.3486 24.5469 75.4416 24.6728V24.7735C76.5899 24.8406 77.6051 25.1427 78.4872 25.6714C79.3693 26.2001 80.0683 26.8967 80.5675 27.7611C81.0751 28.6254 81.3248 29.5989 81.3248 30.6815V30.7151C81.3248 32.1585 80.9836 33.4005 80.2929 34.4579C79.6106 35.5069 78.6287 36.321 77.3638 36.9C76.099 37.4791 74.5928 37.7644 72.8287 37.7644H64.5322V33.9292H64.5239Z" fill="#1E3787"/>
        <path d="M84.5035 16.2722C83.9876 15.7519 83.7296 15.1393 83.7296 14.426C83.7296 13.7043 83.9876 13.0916 84.5035 12.5797C85.0194 12.0678 85.6519 11.816 86.4008 11.816C87.1497 11.816 87.7821 12.0678 88.2897 12.5797C88.7973 13.0916 89.0553 13.7043 89.0553 14.426C89.0553 15.1309 88.7973 15.7519 88.2897 16.2722C87.7821 16.7925 87.1497 17.0527 86.4008 17.0527C85.6519 17.0527 85.0194 16.7925 84.5035 16.2722ZM83.896 19.4025H88.8805V37.7895H83.896V19.4025Z" fill="#1E3787"/>
        <path d="M96.3448 36.8748C95.3712 36.0188 94.8803 34.6089 94.8803 32.6368V23.1705H92.3506V19.3941H94.8803V14.9043H99.8981V19.3941H103.235V23.1705H99.8981V32.0913C99.8981 32.9473 100.089 33.5431 100.464 33.8872C100.847 34.2229 101.404 34.3907 102.153 34.3907C102.378 34.3907 102.578 34.3823 102.752 34.3655C102.919 34.3487 103.085 34.332 103.227 34.3068V37.9741C102.952 38.0161 102.619 38.0664 102.211 38.1C101.812 38.142 101.346 38.1587 100.822 38.1587C98.8163 38.1587 97.3184 37.7307 96.3448 36.8748Z" fill="#1E3787"/>
        <path d="M112.497 37.0007C111.44 36.2622 110.658 35.2636 110.133 34.0048H110.083V37.7812H107.837V13.033H110.083V23.6825H110.133C110.641 22.4489 111.432 21.4586 112.505 20.7201C113.578 19.9816 114.81 19.6123 116.2 19.6123C117.673 19.6123 118.971 19.9984 120.086 20.7621C121.201 21.5257 122.075 22.5999 122.707 23.9762C123.339 25.3525 123.647 26.9722 123.647 28.8352V28.852C123.647 30.7067 123.339 32.3263 122.715 33.711C122.091 35.1041 121.217 36.1783 120.094 36.942C118.971 37.7057 117.664 38.0917 116.166 38.0917C114.777 38.1085 113.553 37.7392 112.497 37.0007ZM118.729 35.2048C119.57 34.6174 120.227 33.7782 120.685 32.6956C121.143 31.613 121.376 30.3374 121.376 28.8688V28.852C121.376 27.3918 121.143 26.1162 120.685 25.0336C120.227 23.9511 119.57 23.1202 118.729 22.5328C117.881 21.9453 116.899 21.6516 115.759 21.6516C114.644 21.6516 113.67 21.9537 112.813 22.5496C111.964 23.1454 111.29 23.993 110.799 25.0756C110.308 26.1582 110.058 27.417 110.058 28.852V28.8688C110.058 30.2955 110.3 31.5627 110.791 32.6536C111.282 33.7446 111.947 34.5922 112.805 35.1964C113.662 35.7923 114.635 36.0944 115.742 36.0944C116.89 36.086 117.889 35.7923 118.729 35.2048Z" fill="#1E3787"/>
        <path d="M128.84 37.4455C127.958 37.0091 127.267 36.3881 126.776 35.5909C126.285 34.7936 126.036 33.8789 126.036 32.8383V32.8131C126.036 31.2941 126.585 30.0856 127.683 29.2045C128.782 28.3149 130.346 27.8114 132.376 27.6855L139.009 27.2575V29.0199L132.651 29.4479C131.27 29.5486 130.196 29.8926 129.447 30.4717C128.69 31.0507 128.316 31.8312 128.316 32.8131V32.8466C128.316 33.8285 128.69 34.6258 129.439 35.2216C130.188 35.8258 131.153 36.1196 132.343 36.1196C133.383 36.1196 134.324 35.9014 135.156 35.4566C135.988 35.0202 136.654 34.416 137.145 33.6439C137.636 32.8718 137.885 32.0242 137.885 31.0675V25.7637C137.885 24.4713 137.502 23.4559 136.737 22.7258C135.971 21.9957 134.898 21.6264 133.516 21.6264C132.235 21.6264 131.186 21.9202 130.379 22.4992C129.572 23.0867 129.064 23.8839 128.873 24.8993L128.84 25.0672H126.676L126.693 24.8574C126.809 23.8252 127.151 22.9188 127.733 22.13C128.307 21.3411 129.089 20.7201 130.08 20.2669C131.07 19.8137 132.218 19.5872 133.55 19.5872C134.898 19.5872 136.063 19.8305 137.045 20.3173C138.027 20.804 138.784 21.4922 139.325 22.3817C139.866 23.2713 140.132 24.3287 140.132 25.5371V37.7476H137.885V34.4747H137.835C137.519 35.1964 137.061 35.8258 136.454 36.3629C135.855 36.9 135.164 37.3196 134.382 37.6217C133.6 37.9239 132.768 38.0749 131.902 38.0749C130.745 38.1085 129.722 37.8903 128.84 37.4455Z" fill="#1E3787"/>
        <path d="M143.91 19.948H146.157V23.0027H146.207C146.656 22.0292 147.372 21.2236 148.354 20.5942C149.327 19.9564 150.525 19.6459 151.94 19.6459C153.904 19.6459 155.435 20.2417 156.533 21.425C157.632 22.6083 158.181 24.2615 158.181 26.3679V37.7895H155.934V26.7372C155.934 25.0839 155.535 23.8167 154.744 22.944C153.954 22.0712 152.797 21.6432 151.291 21.6432C150.259 21.6432 149.36 21.8782 148.587 22.3481C147.813 22.8181 147.214 23.4643 146.789 24.2951C146.365 25.1259 146.148 26.0994 146.148 27.2155V37.7812H143.902V19.948H143.91Z" fill="#1E3787"/>
        <path d="M162.167 13.033H164.397V37.7812H162.167V13.033ZM163.856 28.3653H164.472L173.176 19.948H175.931L167.426 28.1807H167.276L163.856 31.3864V28.3653ZM166.236 28.8268L167.734 27.3163L176.097 37.7812H173.459L166.236 28.8268Z" fill="#1E3787"/>
        <path d="M180.149 36.9838C178.951 36.2369 178.019 35.1712 177.37 33.7949C176.721 32.4186 176.396 30.7905 176.396 28.9191V28.9023C176.396 27.0392 176.721 25.4112 177.37 24.0181C178.019 22.625 178.935 21.5424 180.116 20.7787C181.298 20.0151 182.671 19.629 184.252 19.629C185.825 19.629 187.189 19.9983 188.346 20.7368C189.494 21.4753 190.385 22.5159 191.017 23.8502C191.65 25.1846 191.957 26.7455 191.957 28.533V29.4226H177.52V27.6099H190.867L189.727 29.238V28.382C189.727 26.9217 189.494 25.6881 189.02 24.6895C188.546 23.6908 187.905 22.9355 187.081 22.4152C186.257 21.9033 185.309 21.6431 184.235 21.6431C183.162 21.6431 182.196 21.9033 181.364 22.432C180.532 22.9607 179.867 23.7244 179.384 24.7398C178.901 25.7552 178.66 26.9637 178.66 28.382V29.238C178.66 30.6898 178.901 31.9234 179.384 32.9389C179.867 33.9543 180.541 34.7348 181.414 35.2719C182.288 35.809 183.312 36.0775 184.493 36.0775C185.359 36.0775 186.124 35.9432 186.807 35.6747C187.489 35.4061 188.055 35.0285 188.504 34.5334C188.953 34.0382 189.278 33.4676 189.478 32.8214L189.528 32.6703H191.741L191.708 32.8382C191.55 33.5934 191.258 34.29 190.851 34.9362C190.435 35.5824 189.91 36.1446 189.278 36.6146C188.646 37.0929 187.922 37.4538 187.098 37.714C186.274 37.9741 185.4 38.1 184.443 38.1C182.779 38.1084 181.348 37.7391 180.149 36.9838Z" fill="#1E3787"/>
        <path d="M194.961 19.9479H197.208V23.1537H197.258C197.574 22.0543 198.115 21.1899 198.864 20.5605C199.621 19.9311 200.537 19.6206 201.61 19.6206C201.902 19.6206 202.176 19.6458 202.426 19.6877C202.675 19.7297 202.867 19.7801 203 19.822V22.0375C202.85 21.9704 202.634 21.9116 202.334 21.8613C202.043 21.8109 201.693 21.7858 201.294 21.7858C200.462 21.7858 199.746 21.9872 199.122 22.3984C198.506 22.8012 198.032 23.3803 197.691 24.1188C197.358 24.8657 197.192 25.7384 197.192 26.7455V37.7894H194.945V19.9479H194.961Z" fill="#1E3787"/>
        <path d="M24.7811 0H0V24.9916H24.7811V0Z" fill="#1E3787"/>
        <path d="M24.7811 25.0084H0V50H24.7811V25.0084Z" fill="#FFB900"/>
        <path d="M24.7228 24.9916C17.8826 24.9916 12.3323 19.3941 12.3323 12.4958C12.3323 5.59752 17.8826 0 24.7228 0C31.563 0 37.1133 5.59752 37.1133 12.4958C37.1133 19.3941 31.563 24.9916 24.7228 24.9916Z" fill="#FFB900"/>
        <path d="M24.7228 50C17.8826 50 12.3323 44.4025 12.3323 37.5042C12.3323 30.6059 17.8826 25.0084 24.7228 25.0084C31.563 25.0084 37.1133 30.6059 37.1133 37.5042C37.1133 44.4025 31.563 50 24.7228 50Z" fill="#FFB900"/>
        <path d="M0 49.9749V25.0084C6.83185 25.0084 12.3739 30.5975 12.3739 37.4874V37.5042C12.3739 44.3941 6.83185 49.9749 0 49.9749Z" fill="#1E3787"/>
      </svg>
      <h1>List of posts</h1>
    </div>

    <div class="top-links">
      <div><a class="h-link" href="#posts-list"># Load</a></div>
      <div><a class="h-link" href="#post-add"># Add</a></div>
    </div>

    <!-- Кнопка для загрузки постов -->
    <button @click="fetchPosts" :disabled="isLoading || posts.length > 0">
      {{ posts.length > 0 ? "Posts Loaded" : "Load Posts" }}
    </button>

    <!-- Список постов -->
    <ul v-if="!isLoading && posts.length" id="posts-list" ref="topElement">
      <li v-for="post in posts" :key="post.id">
        <router-link :to="{ name: 'Post', params: { id: post.id }}">{{ post.title }}</router-link>
        <div class="btn-wrap">
          <button @click="startEditing(post)">Edit</button>
          <button @click="deletePost(post.id)">Delete</button>
        </div>
      </li>
    </ul>

    <p v-if="isLoading">Loading...</p>

    <!-- Модальное окно для редактирования поста -->
    <div ref="editingElement" class="editingElement"></div>
    <div v-if="editingPost">
      <h3>Edit Post</h3>
      <form @submit.prevent="handleEditPost">
        <input v-model="editingPost.title" placeholder="Post Title" required />
        <textarea v-model="editingPost.body" placeholder="Post Body" required></textarea>
        <button type="submit">Save Changes</button>
        <button type="button" @click="cancelEditing">Cancel</button>
      </form>
    </div>

    <!-- Форма для добавления нового поста -->
    <h2 id="post-add">Add new post</h2>
    <form @submit.prevent="handleAddPost">
      <input v-model="newPost.title" placeholder="Post Title" required />
      <textarea v-model="newPost.body" placeholder="Post Body" required></textarea>
      <button type="submit">Add post</button>
    </form>

    <p v-if="error">{{ error }}</p>

  </div>
</template>

<script lang="ts">
import { defineComponent, computed, ref } from 'vue';
import { usePostStore, Post } from '../stores/postStore';

export default defineComponent({
  name: 'HomeView',
  setup() {
    const postStore = usePostStore();

    // Реактивные свойства для Pinia Store
    const posts = computed(() => postStore.posts);
    const isLoading = computed(() => postStore.isLoading);
    const error = computed(() => postStore.error);

    // Форма для добавления нового поста
    const newPost = ref<Omit<Post, 'id'>>({
      title: '',
      body: '',
      userId: 1, // Статический userId
    });

    // Текущее редактирование поста
    const editingPost = ref<Post | null>(null);

    // Действия Pinia Store
    const fetchPosts = postStore.fetchPosts;
    const addPost = postStore.addPost;
    const editPost = postStore.editPost;
    const deletePost = postStore.deletePost;

    // Прокрутка
    const topElement = ref();
    const editingElement = ref();

    // Добавление нового поста
    const handleAddPost = () => {
      addPost(newPost.value);
      newPost.value = { title: '', body: '', userId: 1 }; // Очистка формы
      topElement.value.scrollIntoView({ behavior: "smooth" });
    };

    // Начало редактирования
    const startEditing = (post: Post) => {
      editingPost.value = { ...post }; // Копируем свойства поста
      editingElement.value.scrollIntoView({ behavior: "smooth" });
    };

    // Завершение редактирования
    const handleEditPost = () => {
      if (editingPost.value) {
        editPost(editingPost.value); // Сохраняем изменения
        editingPost.value = null; // Закрываем форму редактирования
      }
    };

    // Отмена редактирования
    const cancelEditing = () => {
      editingPost.value = null;
    };

    return {
      posts,
      isLoading,
      error,
      newPost,
      editingPost,
      fetchPosts,
      handleAddPost,
      startEditing,
      handleEditPost,
      cancelEditing,
      deletePost,
      topElement,
      editingElement,
      scrollTo,
    };
  },
});
</script>

<style>
  .top-links {
    margin-bottom: 25px;
  }

  textarea {
    width: 100%;
    height: 150px;
    padding: 12px 20px;
    border: 2px solid #ccc;
    border-radius: 12px;
    background-color: #f8f8f8;
    font-size: 16px;
    resize: none;
    margin-bottom: 15px;
  }

  input {
    width: 100%;
    padding: 12px 20px;
    border: 2px solid #ccc;
    border-radius: 12px;
    background-color: #f8f8f8;
    font-size: 16px;
    margin-bottom: 15px;
  }

  ul {
    list-style-type: none;
    padding-left: unset;
    margin-top: 35px;
    margin-bottom: 35px;
  }

  ul li {
    margin-bottom: 25px;
  }

  .btn-wrap {
    margin-top: 10px;
  }

  .btn-wrap button {
    padding: 5px 12px;
  }

  a {
    font-size: 20px;
    text-transform: capitalize;
    text-decoration: none;
    display: inline-block;
    margin-bottom: 10px;
  }

  a:hover {
    text-decoration: underline;
  }

  #posts-list {
    padding-top: 50px;
  }

  #posts-list a {
    color: #000000;
    font-size: 18px;
  }

  h2#post-add {
    margin-top: 35px;
  }
</style>
